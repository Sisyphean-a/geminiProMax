[{"filePath":"F:\\geminiProMax\\env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\eslint.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\App.vue","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\background.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\background.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\content-script.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\content-script.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\features\\autosave\\components\\AutosaveIndicator.vue","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\features\\autosave\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\features\\timeline\\components\\TimelineWidget.vue","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\features\\timeline\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_mutations' is defined but never used.","line":82,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":47}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createApp } from 'vue'\nimport type { ComponentPublicInstance } from 'vue'\nimport TimelineWidget from './components/TimelineWidget.vue'\nimport { injectStyles } from '@/shared/utils/shadow'\nimport { normalizeText, hashString } from '@/shared/utils/text'\n\n// --- 妯″潡鐘舵€?---\nlet timelineInstance: ComponentPublicInstance | null = null\nlet activeUserTurnSelector = ''\n\n// --- 鐢ㄦ埛娑堟伅閫夋嫨鍣ㄥ€欓€夊垪琛?---\nconst CANDIDATE_SELECTORS = [\n  '.user-query-bubble-with-background',\n  '.user-query-bubble-container',\n  '.user-query-container',\n  '.query-text-line',\n  'user-query-content .user-query-bubble-with-background',\n  'div[aria-label=\"User message\"]',\n  'article[data-author=\"user\"]',\n  'article[data-turn=\"user\"]',\n  '[data-message-author-role=\"user\"]',\n  'div[role=\"listitem\"][data-user=\"true\"]',\n  '.user-query',\n  'div[data-message-id]',\n]\n\n// --- 娼滃湪鐨勮亰澶╁鍣?---\nconst potentialContainers = [\n  document.querySelector('main'),\n  document.querySelector('#chat-history-container'),\n  document.querySelector('div[class*=\"chat-history\"]'),\n  document.body,\n].filter((c) => c !== null) as HTMLElement[]\n\n/**\n * 杩囨护鎺夊祵濂楃殑鍏冪礌锛屽彧淇濈暀椤跺眰\n */\nfunction filterTopLevel(elements: HTMLElement[]): HTMLElement[] {\n  const descendants = new Set<HTMLElement>()\n  for (let i = 0; i < elements.length; i++) {\n    const el = elements[i]\n    for (let j = 0; j < elements.length; j++) {\n      if (i !== j && elements[j].contains(el)) {\n        descendants.add(el)\n        break\n      }\n    }\n  }\n  return elements.filter((el) => !descendants.has(el))\n}\n\n/**\n * 鍒濆鍖?Timeline 灏忛儴浠禱n */\nexport function enableTimeline(): void {\n  const container = document.createElement('div')\n  container.id = 'gemini-promax-timeline-root'\n  container.style.position = 'fixed'\n  container.style.top = '0'\n  container.style.left = '0'\n  container.style.width = '0'\n  container.style.height = '0'\n  container.style.overflow = 'visible'\n  container.style.zIndex = '2147483647'\n  container.style.pointerEvents = 'none'\n  document.body.appendChild(container)\n\n  const shadow = container.attachShadow({ mode: 'open' })\n  injectStyles(shadow)\n\n  const appRoot = document.createElement('div')\n  appRoot.style.pointerEvents = 'auto'\n  shadow.appendChild(appRoot)\n\n  const app = createApp(TimelineWidget)\n  timelineInstance = app.mount(appRoot)\n}\n\n/**\n * 澶勭悊鑱婂ぉ鍖哄煙鐨?DOM 鍙樺寲锛屾洿鏂?Timeline\n */\nexport function handleChatMutations(_mutations: MutationRecord[]): void {\n  let targetContainer: HTMLElement | null = null\n\n  // 鍙戠幇闃舵锛氭壘鍒板悎閫傜殑閫夋嫨鍣╘n  if (!activeUserTurnSelector) {\n    for (const container of potentialContainers) {\n      for (const sel of CANDIDATE_SELECTORS) {\n        if (container.querySelector(sel)) {\n          activeUserTurnSelector = sel\n          targetContainer = container\n          break\n        }\n      }\n      if (targetContainer) break\n    }\n  } else {\n    for (const container of potentialContainers) {\n      if (container.querySelector(activeUserTurnSelector)) {\n        targetContainer = container\n        break\n      }\n    }\n    if (!targetContainer && potentialContainers.length > 0) {\n      targetContainer = potentialContainers[0]\n    }\n  }\n\n  if (!targetContainer || !activeUserTurnSelector) {\n    return\n  }\n\n  const rawElements = Array.from(\n    targetContainer.querySelectorAll(activeUserTurnSelector),\n  ) as HTMLElement[]\n  const uniqueElements = filterTopLevel(rawElements)\n\n  const items = uniqueElements.map((el, index) => {\n    const contentEl = el.querySelector('.user-query-content') || el.querySelector('p') || el\n    const rawText = contentEl.textContent || ''\n    const cleanText = normalizeText(rawText)\n    const summary = cleanText.slice(0, 20) || `Query ${index + 1}`\n\n    let id = el.dataset.promaxTurnId\n    if (!id) {\n      const nativeId = el.closest('[id]')?.id\n      if (nativeId && nativeId.length > 5) {\n        id = nativeId\n      } else {\n        id = `u-${hashString(cleanText)}`\n      }\n      el.dataset.promaxTurnId = id\n      if (!el.id) el.id = id\n    }\n    return { id, text: summary }\n  })\n\n  if (timelineInstance && 'updateItems' in timelineInstance) {\n    ;(\n      timelineInstance as { updateItems: (items: { id: string; text: string }[]) => void }\n    ).updateItems(items)\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\features\\translation\\components\\TranslationWidget.vue","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2416,2419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2416,2419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<template>\n  <button class=\"gemini-translate-btn\" @click=\"handleTranslate\" :disabled=\"isTranslating\">\n    <span v-if=\"isTranslating\" class=\"spinner\">鈴?/span>\n    <span v-else>Thinking Process Translate</span>\n  </button>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onUnmounted } from 'vue'\nimport { extractTextNodes } from '../../../shared/utils/domUtils'\n\n// ==================== 鎬ц兘浼樺寲閰嶇疆 ====================\nconst CACHE_MAX_SIZE = 500 // LRU 缂撳瓨鏈€澶ф潯鐩暟\nconst DEBOUNCE_MS = 150 // 闃叉姈寤惰繜\n\n// 鍏ㄥ眬缈昏瘧缂撳瓨锛氬師鏂?-> 璇戞枃 鐨勬槧灏勶紙LRU 绛栫暐锛塡nconst translationCache = new Map<string, string>()\n\n/**\n * LRU 缂撳瓨璁剧疆锛堣闂椂绉诲埌鏈熬锛岃秴鍑洪檺鍒舵椂鍒犻櫎鏈€鏃э級\n */\nfunction cacheSet(key: string, value: string): void {\n  if (translationCache.has(key)) {\n    translationCache.delete(key) // 绉婚櫎鏃т綅缃甛n  } else if (translationCache.size >= CACHE_MAX_SIZE) {\n    // 鍒犻櫎鏈€鏃х殑鏉＄洰锛圡ap 杩唬椤哄簭鏄彃鍏ラ『搴忥級\n    const oldest = translationCache.keys().next().value\n    if (oldest) translationCache.delete(oldest)\n  }\n  translationCache.set(key, value)\n}\n\n/**\n * LRU 缂撳瓨鑾峰彇锛堣闂椂绉诲埌鏈熬锛塡n */\nfunction cacheGet(key: string): string | undefined {\n  const value = translationCache.get(key)\n  if (value !== undefined) {\n    translationCache.delete(key)\n    translationCache.set(key, value)\n  }\n  return value\n}\n\nconst props = defineProps({\n  rootSelector: {\n    type: String,\n    required: true,\n  },\n})\n\nconst isTranslating = ref(false)\nconst isTranslated = ref(false)\n\n// 鐩戣闈㈡澘灞曞紑锛岃嚜鍔ㄦ仮澶嶇炕璇慭nlet panelObserver: MutationObserver | null = null\nlet debounceTimer: ReturnType<typeof setTimeout> | null = null\n\nonMounted(() => {\n  setupPanelObserver()\n})\n\nonUnmounted(() => {\n  if (panelObserver) {\n    panelObserver.disconnect()\n    panelObserver = null\n  }\n  if (debounceTimer) {\n    clearTimeout(debounceTimer)\n  }\n})\n\n/**\n * 璁剧疆闈㈡澘灞曞紑鐘舵€佺洃鍚櫒锛堝甫闃叉姈锛塡n */\nfunction setupPanelObserver() {\n  const rootEl = document.querySelector(props.rootSelector) as HTMLElement\n  if (!rootEl) return\n\n  panelObserver = new MutationObserver(() => {\n    // 鍙湁缈昏瘧杩囨墠闇€瑕佹仮澶峔n    if (!isTranslated.value) return\n\n    // 闃叉姈锛氶伩鍏嶉绻佽Е鍙慭n    if (debounceTimer) clearTimeout(debounceTimer)\n\n    debounceTimer = setTimeout(() => {\n      scheduleRestoreTranslation()\n    }, DEBOUNCE_MS)\n  })\n\n  panelObserver.observe(rootEl, {\n    childList: true,\n    subtree: true,\n    attributes: true,\n  })\n}\n\n/**\n * 浣跨敤 requestIdleCallback 鍦ㄧ┖闂叉椂鎭㈠缈昏瘧锛堥伩鍏嶉樆濉?UI锛塡n */\nfunction scheduleRestoreTranslation() {\n  if ('requestIdleCallback' in window) {\n    ;(window as any).requestIdleCallback(\n      () => restoreTranslation(),\n      { timeout: 500 }, // 鏈€澶氱瓑寰?500ms\n    )\n  } else {\n    // 闄嶇骇锛氫娇鐢?setTimeout\n    setTimeout(restoreTranslation, 0)\n  }\n}\n\n/**\n * 鑾峰彇鍐呭鍏冪礌\n */\nfunction getContentElement(): HTMLElement | null {\n  const rootEl = document.querySelector(props.rootSelector) as HTMLElement\n  if (!rootEl) return null\n\n  let contentEl = rootEl.querySelector('div[data-test-id=\"thoughts-content\"]') as HTMLElement\n  if (!contentEl) contentEl = rootEl.querySelector('.mat-expansion-panel-body') as HTMLElement\n\n  if (!contentEl) {\n    const headerBtn = rootEl.querySelector('button[data-test-id=\"thoughts-header-button\"]')\n    if (headerBtn && headerBtn.nextElementSibling) {\n      contentEl = headerBtn.nextElementSibling as HTMLElement\n    }\n  }\n\n  return contentEl\n}\n\n/**\n * 鎭㈠宸茬紦瀛樼殑缈昏瘧\n */\nfunction restoreTranslation() {\n  const contentEl = getContentElement()\n  if (!contentEl) return\n\n  const textNodes = extractTextNodes(contentEl)\n  let restoredCount = 0\n\n  textNodes.forEach((node) => {\n    const originalText = node.textContent || ''\n    const cachedTranslation = cacheGet(originalText)\n    if (cachedTranslation && cachedTranslation !== originalText) {\n      node.textContent = cachedTranslation\n      restoredCount++\n    }\n  })\n\n  if (restoredCount > 0) {\n    console.log(`Gemini Pro Max: 宸蹭粠缂撳瓨鎭㈠ ${restoredCount} 鏉＄炕璇慲)\n  }\n}\n\nconst handleTranslate = async () => {\n  const rootEl = document.querySelector(props.rootSelector) as HTMLElement\n  if (!rootEl) {\n    console.error('Gemini Pro Max: Root element not found:', props.rootSelector)\n    return\n  }\n\n  const contentEl = getContentElement()\n  if (!contentEl) {\n    console.error('Gemini Pro Max: Content element not found inside root')\n    return\n  }\n\n  isTranslating.value = true\n\n  try {\n    const textNodes = extractTextNodes(contentEl)\n    const texts = textNodes.map((node) => node.textContent || '')\n\n    // 妫€鏌ョ紦瀛橈紝鍒嗙闇€瑕佺炕璇戠殑鏂囨湰\n    const toTranslate: { index: number; text: string }[] = []\n    const results: string[] = new Array(texts.length)\n\n    texts.forEach((text, index) => {\n      const cached = cacheGet(text)\n      if (cached) {\n        results[index] = cached\n      } else {\n        toTranslate.push({ index, text })\n      }\n    })\n\n    // 鍙炕璇戞湭缂撳瓨鐨勬枃鏈琝n    if (toTranslate.length > 0) {\n      const response = await chrome.runtime.sendMessage({\n        type: 'TRANSLATE_BATCH',\n        payload: toTranslate.map((item) => item.text),\n      })\n\n      if (\n        response &&\n        response.translatedTexts &&\n        response.translatedTexts.length === toTranslate.length\n      ) {\n        toTranslate.forEach((item, i) => {\n          const translated = response.translatedTexts[i]\n          results[item.index] = translated\n          // 缂撳瓨缈昏瘧缁撴灉锛圠RU 绛栫暐锛塡n          cacheSet(item.text, translated)\n        })\n      } else {\n        console.error('Translation mismatch or error', response)\n        return\n      }\n    }\n\n    // 搴旂敤鎵€鏈夌炕璇戠粨鏋淺n    textNodes.forEach((node, index) => {\n      if (results[index]) {\n        node.textContent = results[index]\n      }\n    })\n\n    isTranslated.value = true\n    console.log(\n      `Gemini Pro Max: 缈昏瘧瀹屾垚锛屾柊缈昏瘧 ${toTranslate.length} 鏉★紝浠庣紦瀛樻仮澶?${texts.length - toTranslate.length} 鏉,\n    )\n  } catch (e) {\n    console.error('Translation failed', e)\n  } finally {\n    isTranslating.value = false\n  }\n}\n</script>\n\n<style scoped>\n.gemini-translate-btn {\n  margin-left: 10px;\n  background: transparent;\n  border: 1px solid #dadce0;\n  border-radius: 4px;\n  padding: 4px 8px;\n  font-family: 'Google Sans', sans-serif;\n  font-size: 12px;\n  color: #1a73e8;\n  cursor: pointer;\n  display: inline-flex;\n  align-items: center;\n}\n\n.gemini-translate-btn:hover {\n  background: #f1f3f4;\n}\n\n.gemini-translate-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.spinner {\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n@media (prefers-color-scheme: dark) {\n  .gemini-translate-btn {\n    color: #8ab4f8;\n    border-color: #5f6368;\n  }\n  .gemini-translate-btn:hover {\n    background: #303134;\n  }\n}\n</style>\n","usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\features\\translation\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\main.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\main.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\shared\\utils\\domUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\shared\\utils\\domUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\shared\\utils\\shadow.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\shared\\utils\\text.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\stores\\counter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\src\\stores\\counter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\geminiProMax\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
